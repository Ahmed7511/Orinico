<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"  href="style.css" >
    <script src="https://kit.fontawesome.com/c10c83c5b7.js" crossorigin="anonymous"></script>
    <script>
                     
    </script>

    <title>product-orinico</title>
</head>
<body>

  <header>
    <nav>
      <ul> 
       <li><a href="index.html">Orinico</a></li>
       <li class="cart">
        <a href="panier.html">
         <i class="fas fa-shopping-cart"></i>panier<span>0</span>
            </a>
       </li>
     </ul>
    </nav>
  </header>
 <h1> Choisir ce produit</h1>

  <p>Personnaliser votre produit  </p>
<div id="product" >

</div>




                  <div id="add-cart"><a class="add-card" onchange="change()" >Ajouter au panier</a></div>



          <aside>''
              <h3>Toute l'équipe d'Orinoco vous remercie de votre visite.</h3>
          </aside>
  

           <footer class="socials">
                               <a class="social" href="index.html"><span class="fa fa-twitter"></span><br>twitter</a>
      
                                <a class="social" href="index.html"><span class="fa fa-facebook"></span><br>facebook</a>
  
                                <a class="social" href="index.html"><span class="fa fa-dribbble"></span><br>dribbble</a>
  
                                <a class="social" href="index.html"><span class="fa fa-instagram"></span><br>instagram</a>  
            </footer>
            
  

             <script >

               const lien = window.location.search.substring(4)
               
       function main(){
       var request = new XMLHttpRequest();
 
       request.open('GET' , 'http://localhost:3000/api/cameras/'+ lien);

request.onload = function (){

  if(this.status == 200){
    var productData = JSON.parse(request.responseText);
    var output=""
    output += '<div class="product">'+
              '<img src="' + productData.imageUrl+'">' +
              '<ul>' +
             '<li><strong>ID :</strong>' +productData._id +' </li>' +
             '<li><strong>Lentille :</strong>' +
               
               '<select id ="ddselect" onchange="change();" >' +
                       '<option > ' + productData.lenses[0] +' </option>' +
                       '<option > ' + productData.lenses[1] +' </option>' + 
                       '<option > ' + productData.lenses[2] + ' </option>' + 
                '</select>' + 
                 //   '<input type="text" id ="txtvalue">' + 
                
               '<li><strong>Name :</strong>' +productData.name +' </li>' +
                 '<li id="price"><strong>price:</strong>' +productData.price/100+'€' +' </li>' +
                  '<li><strong>Description :</strong>' +productData.description +' </li>' +
                   '<li><strong>Quantité : </strong>' + productData.quantity + '</li>' +
                  '</ul>' +

                  '</div>'
               
                      }
                    document.getElementById('product').innerHTML = output ;

                      
let carts = document.querySelectorAll('div > a');  

for(let i=0; i < carts.length; i++){
  carts[i].addEventListener('click', () =>{
  cartNumbers(productData); // on click on lance la function
})
}
function onloadCartNumbers(){
  let productNumbers = localStorage.getItem('cartNumbers');
if(productNumbers){
  document.querySelector('.cart span').textContent = productNumbers ; 
}

}

function cartNumbers(productData){

  let productNumbers = localStorage.getItem('cartNumbers');
productNumbers = parseInt(productNumbers);            // converti le productNumbers en numéro 
if(productNumbers){

localStorage.setItem('cartNumbers',productNumbers + 1);
document.querySelector('.cart span').textContent = productNumbers + 1;

}else{
  localStorage.setItem('cartNumbers', 1);
  document.querySelector('.cart span').textContent = 1;
}

function setItems(productData){
  let cartItems = JSON.parse(localStorage.getItem('productInCart')) || [];
   productData.quantity = 0 ;
if(productData){
    productData.quantity = +1 ;
}else{
  cartItems.push(productData);                

     productData.quantity += 1 ;
}

localStorage.setItem('productInCart',JSON.stringify(cartItems)) || [];  
  

}
setItems(productData) ;


let cartCost = localStorage.getItem("totalCost");
  //console.log(typeof cartCost)
  if(cartCost != null){
    cartCost = parseInt(cartCost);
    localStorage.setItem("totalCost", cartCost + productData.price/100 )
  }else{
  localStorage.setItem("totalCost", productData.price/100)
  }

}

 



onloadCartNumbers();








};


request.send();

 
}
main();

function change(){
  var d = document.getElementById('ddselect'); 
  d.options[d.selectedIndex].text ;
 // document.getElementById('txtvalue').value = displaytext ;
} 
       </script>



        </body>
</html>